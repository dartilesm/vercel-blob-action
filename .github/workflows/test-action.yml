name: Test Action

on: [push]

jobs:
  test-action:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create test file
        run: |
          mkdir -p test-files
          echo "Test file created at $(date)" > test-files/test-upload.txt
          echo "GitHub SHA: ${{ github.sha }}" >> test-files/test-upload.txt
          echo "Workflow run: ${{ github.run_number }}" >> test-files/test-upload.txt
          cat test-files/test-upload.txt

      - name: Test Upload to Vercel Blob
        id: upload
        uses: ./
        with:
          source: "test-files/test-upload.txt"
          destination: "github-actions-test/test-${{ github.run_number }}-${{ github.sha }}.txt"
          read-write-token: ${{ secrets.BLOB_READ_WRITE_TOKEN }}

      - name: Verify upload result
        run: |
          echo "âœ… File uploaded successfully!"
          echo "ğŸ“ Blob URL: ${{ steps.upload.outputs.url }}"

          # Verify the URL is valid
          if [[ "${{ steps.upload.outputs.url }}" =~ ^https:// ]]; then
            echo "âœ… URL format is valid"
          else
            echo "âŒ URL format is invalid"
            exit 1
          fi
